<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product List</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:#222;
      display: flex;
      flex-direction: column;
      background: #f8fafc;
    }
    .main-content { flex: 1; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
    .header { margin: 2rem 0 1.5rem; }
    .header h1 { margin: 0 0 1rem; text-align: center; color: #333; }
    .user-info { text-align: center; color: #555; margin-bottom: 1rem; }
    .actions { display: flex; gap: .5rem; justify-content: center; margin-bottom: 1.5rem; flex-wrap: wrap; }
    .btn { display: inline-block; padding: .5rem .75rem; border: 1px solid #bbb; border-radius: .5rem; background: #f7f7f7; text-decoration: none; color: #222; transition: all 0.3s ease; }
    .btn:hover { background: #eee; transform: translateY(-1px); }
    .btn-primary { background: #007bff; color: white; border-color: #007bff; font-weight: 500; }
    .btn-primary:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,123,255,0.3); }
    .btn-success { background: #28a745; color: white; border-color: #28a745; font-weight: 500; }
    .btn-success:hover { background: #218838; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(40,167,69,0.3); }
    .search-form { text-align: center; margin-bottom: 1.5rem; }
    .search-form input[type="text"] { padding: .5rem; border: 1px solid #ccc; border-radius: .5rem; margin-right: .5rem; min-width: 200px; }
    .search-form input[type="submit"] { padding: .5rem 1rem; border: 1px solid #bbb; border-radius: .5rem; background: #f7f7f7; cursor: pointer; }
    .search-form input[type="submit"]:hover { background: #eee; }
    .message { text-align: center; margin-bottom: 1rem; padding: .5rem; border-radius: .5rem; }
    .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .error { text-align: center; color: red; margin-bottom: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
    th, td { border: 1px solid #ddd; padding: .5rem; text-align: left; }
    th { background: #fafafa; font-weight: 600; }
    .top-spacer { height: .5rem; }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <%- include('../partials/navbar', { role, name }) %>

  <div class="main-content">
    <div class="top-spacer"></div>

    <div class="container">
    <div class="header">
      <h1>Product List</h1>
      <div class="user-info">
        Account: <%= role.slice(0, 1).toUpperCase() + role.slice(1, role.length) %> <%= name %>
      </div>
    </div>
      
    <% if (errors) { %>
      <div class="error"><%= errors %></div>
    <% } %>
    
    <div class="actions">
      <% if (role === "seller") { %>
        <a href="/products/add" class="btn btn-primary">Add Product</a>
      <% } %>
      <a href="/categories" class="btn">List Category</a>
      <a href="/wishlist" class="btn">Wishlist</a>
    </div>

    <% if (msg) { %>
      <div class="message success"><%= msg %></div>
    <% } %>

    <% if (msgEdit) { %>
      <div class="message success"><%= msgEdit %> has been updated</div>
    <% } %>

    <% if (error) { %>
      <div class="message error"><%= error %></div>
    <% } %>
    
    <form action="/products" method="get" class="search-form">
      <input type="text" name="search" placeholder="Search product...">
      <input type="submit" value="Search">
    </form>

    <table>
      <thead>
        <tr>
          <th>No.</th>
          <th>Name</th>
          <th>Category</th>
          <th>Description</th>
          <th>Price</th>
          <th>Last Updated</th>
          <th>Contact</th>
          <th>Seller Name</th>
          <th>Address</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% data.forEach((el, i) => { %>
          <tr>
            <td><%= i + 1 %></td>
            <td><%= el.name %></td>
            <td><%= el.Category.name %></td>
            <td><%= el.description %></td>
            <td><%= el.idr %></td>
            <td><%= el.lastUpdate(el.updatedAt) %></td>
            <td><%= el.User.Profile.phone %></td>
            <td><%= el.User.Profile.fullName %></td>
            <td><%= el.User.Profile.address %></td>
            <td>
              <% if (role === "seller") { %>
                <a href="/products/<%= el.id %>/edit" class="btn">Edit</a>
                <a href="/products/<%= el.id %>/delete" class="btn">Delete</a>
              <% } else { %>
                <a href="/wishlist/add/<%= el.id %>" class="btn btn-success">❤️ Add to Wishlist</a>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  </div>

  <!-- FOOTER -->
  <%- include('../partials/footer') %>
</body>
</html>